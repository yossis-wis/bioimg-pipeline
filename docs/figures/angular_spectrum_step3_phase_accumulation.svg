<svg xmlns="http://www.w3.org/2000/svg" width="900" height="400" viewBox="0 0 900 400">
  <title>Angular spectrum method: Step 3 — Propagation as angle-dependent phase accumulation</title>

  <defs>
    <style>
      .box   { stroke: #000; stroke-width: 2; fill: none; }
      .thin  { stroke: #000; stroke-width: 1.2; fill: none; }
      .dash  { stroke-dasharray: 6 4; opacity: 0.35; }
      .arrow { stroke: #000; stroke-width: 2.2; fill: none; }
      .label { font-family: Arial, Helvetica, sans-serif; font-size: 16px; fill: #000; }
      .eq    { font-family: Arial, Helvetica, sans-serif; font-size: 15px; fill: #000; }
      .small { font-family: Arial, Helvetica, sans-serif; font-size: 13px; fill: #000; }
      .dot   { fill: #000; opacity: 0.85; }
    </style>
  </defs>

  <text class="label" x="40" y="40">Step 3: propagation inside the fiber → different angles pick up different phase</text>

  <text class="eq" x="40" y="72">A<tspan baseline-shift="sub">out</tspan>(k<tspan baseline-shift="sub">x</tspan>,k<tspan baseline-shift="sub">y</tspan>) = A<tspan baseline-shift="sub">in</tspan>(k<tspan baseline-shift="sub">x</tspan>,k<tspan baseline-shift="sub">y</tspan>) · exp(i Δφ(k<tspan baseline-shift="sub">x</tspan>,k<tspan baseline-shift="sub">y</tspan>; λ))</text>

  <!-- k-space box -->
  <rect class="box" x="60" y="110" width="260" height="220"/>
  <text class="label" x="60" y="95">Angular spectrum (before)</text>
  <text class="small" x="72" y="135">A<tspan baseline-shift="sub">in</tspan>(k<tspan baseline-shift="sub">x</tspan>,k<tspan baseline-shift="sub">y</tspan)</text>

  <!-- axes -->
  <line class="thin" x1="190" y1="150" x2="190" y2="300"/>
  <line class="thin" x1="90" y1="225" x2="290" y2="225"/>
  <text class="small" x="295" y="229">k<tspan baseline-shift="sub">x</tspan></text>
  <text class="small" x="193" y="146">k<tspan baseline-shift="sub">y</tspan></text>

  <!-- two example points -->
  <circle class="dot" cx="250" cy="190" r="3"/>
  <circle class="dot" cx="140" cy="270" r="3"/>

  <text class="small" x="258" y="192">θ<tspan baseline-shift="sub">1</tspan></text>
  <text class="small" x="120" y="285">θ<tspan baseline-shift="sub">2</tspan></text>

  <!-- Arrow to propagation box -->
  <line class="arrow" x1="320" y1="220" x2="360" y2="220"/>
  <polygon points="360,220 350,215 350,225" fill="#000"/>

  <!-- Fiber propagation (ray picture) -->
  <rect class="box" x="380" y="110" width="480" height="220"/>
  <text class="label" x="380" y="95">Propagation in fiber (conceptual)</text>

  <!-- fiber walls -->
  <line class="thin" x1="410" y1="150" x2="830" y2="150"/>
  <line class="thin" x1="410" y1="290" x2="830" y2="290"/>

  <!-- two ray paths -->
  <polyline class="arrow" points="420,220 520,160 620,220 720,160 820,220" fill="none"/>
  <polygon points="820,220 810,215 810,225" fill="#000"/>

  <polyline class="arrow" points="420,220 500,190 580,220 660,190 740,220 820,190" fill="none"/>
  <polygon points="820,190 810,185 810,195" fill="#000"/>

  <text class="small" x="430" y="170">higher θ → longer path</text>

  <text class="eq" x="420" y="320">Ray-picture (step-index upper bound):</text>
  <text class="small" x="420" y="343">ΔOPL(θ) = n L (1/cos(θ) − 1)</text>
  <text class="small" x="420" y="363">Δφ(θ,λ) = (2π/λ) · ΔOPL(θ)</text>

  <!-- Note about real fiber -->
  <text class="small" x="640" y="343">(bends/stress mix angles ⇢ extra scrambling)</text>
</svg>
