<svg xmlns="http://www.w3.org/2000/svg" width="900" height="380" viewBox="0 0 900 380">
  <title>Angular spectrum method: Step 5 — FFT again to get angles leaving the output facet</title>

  <defs>
    <style>
      .box   { stroke: #000; stroke-width: 2; fill: none; }
      .thin  { stroke: #000; stroke-width: 1.2; fill: none; }
      .dash  { stroke-dasharray: 6 4; opacity: 0.35; }
      .arrow { stroke: #000; stroke-width: 2.2; fill: none; }
      .label { font-family: Arial, Helvetica, sans-serif; font-size: 16px; fill: #000; }
      .eq    { font-family: Arial, Helvetica, sans-serif; font-size: 15px; fill: #000; }
      .small { font-family: Arial, Helvetica, sans-serif; font-size: 13px; fill: #000; }
      .dot   { fill: #000; opacity: 0.85; }
    </style>
  </defs>

  <text class="label" x="40" y="40">Step 5: after the output facet, you can recover “leaving angles” via FFT</text>
  <text class="eq" x="40" y="72">A<tspan baseline-shift="sub">out</tspan>(k<tspan baseline-shift="sub">x</tspan>,k<tspan baseline-shift="sub">y</tspan) = FFT{U<tspan baseline-shift="sub">out</tspan>(x,y)}</text>

  <!-- Output facet -->
  <rect class="box" x="60" y="120" width="220" height="200"/>
  <text class="label" x="60" y="105">Output facet</text>
  <text class="small" x="72" y="145">U<tspan baseline-shift="sub">out</tspan>(x,y)</text>

  <circle class="dot" cx="95" cy="165" r="3"/>
  <circle class="dot" cx="140" cy="205" r="2"/>
  <circle class="dot" cx="210" cy="185" r="4"/>
  <circle class="dot" cx="170" cy="255" r="3"/>
  <circle class="dot" cx="245" cy="270" r="2"/>
  <circle class="dot" cx="110" cy="285" r="4"/>

  <!-- FFT -->
  <rect class="box" x="310" y="192" width="70" height="56"/>
  <text class="label" x="330" y="226">FFT</text>

  <line class="arrow" x1="280" y1="220" x2="310" y2="220"/>
  <polygon points="310,220 300,215 300,225" fill="#000"/>

  <!-- k-space -->
  <rect class="box" x="410" y="120" width="260" height="200"/>
  <text class="label" x="410" y="105">Angles leaving facet</text>
  <text class="small" x="422" y="145">A<tspan baseline-shift="sub">out</tspan>(k<tspan baseline-shift="sub">x</tspan>,k<tspan baseline-shift="sub">y</tspan)</text>

  <line class="thin" x1="540" y1="160" x2="540" y2="300"/>
  <line class="thin" x1="440" y1="230" x2="640" y2="230"/>
  <circle class="dot" cx="580" cy="205" r="3"/>
  <circle class="dot" cx="515" cy="190" r="3"/>
  <circle class="dot" cx="490" cy="255" r="3"/>
  <circle class="dot" cx="605" cy="270" r="3"/>
  <circle class="dot" cx="550" cy="240" r="3"/>

  <!-- What you can do next -->
  <text class="eq" x="700" y="160">From here you can:</text>
  <text class="small" x="700" y="185">• propagate in free space</text>
  <text class="small" x="700" y="205">• apply an objective pupil (NA stop)</text>
  <text class="small" x="700" y="225">• compute near-field vs far-field</text>

  <line class="dash thin" x1="680" y1="120" x2="680" y2="320"/>
</svg>
